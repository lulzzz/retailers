!function(){window.retailers=window.retailers||{},retailers.map=function(e,t,o,s,a){if(document.getElementById(e)){var i=new google.maps.Geocoder,n=new google.maps.InfoWindow,l=new google.maps.DirectionsRenderer;retailers.shop=function(e,t,o,a,l,d){var c=new google.maps.LatLng(e,t);if(r&&r.setMap&&r.setMap(null),i.geocode({location:c},function(e,t){"OK"===t?(g.panTo(c),g.setCenter(c),g.setZoom(15),r=new google.maps.Marker({position:c,map:g}),n.setContent("<address><b>"+e[0].address_components[0].long_name+"&nbsp;"+e[0].address_components[1].long_name+"<br>"+e[0].address_components[5].long_name+"<br>"+e[0].address_components[6].long_name+",&nbsp;"+e[0].address_components[4].long_name+"</b></address>"),n.open(g,r),$(".list").show()):window.alert("Geocoder failed due to: "+t)}),$(".container-fluid").width()<1e3){g.panBy(200,0);var p="175px"}else var p="225px";if(a||l){console.log("false");var m=$('<div class="storefront-sticker" style="max-width:'+p+';"><div class="storefront-feature" data-sticker><div class="inner"><span class="flag-icon" style="background-image: url('+o+');"></span><div class="logo"><img src="'+l+'"></div></div><div class="tint"><img src="'+a+'" class="bg"></div></div><div class="row pt-1"><div class="col-xs-12 col-sm-12 col-md-6 pr-0"></div><div class="col-xs-12 col-sm-12 col-md-6"><a class="btn btn-secondary btn-sm pull-right" href="/app/'+d+"?shop="+s+'">View Retailer</button></div></div></div>')}else var m=$('<div class="storefront-sticker" style="max-width:'+p+';"><div class="storefront-feature" data-sticker><div class="inner"><div class="logo">NAME</div></div><div class="row pt-1"><div class="col-xs-12 col-sm-12 col-md-6 pr-0"></div><div class="col-xs-12 col-sm-12 col-md-6"><a class="btn btn-secondary btn-sm pull-right" href="#">View Retailer</button></div></div></div>');$("div[data-sticker]").remove(),m.appendTo("div[data-map]")},retailers.json=function(e){qwest.get(e).then(function(e,t){$("#locating").hide(),$(".list").removeClass("list-disabled"),p.clear(),p.add(t),p.sort("distance");var o=$(".location");retailers.shop(o.closest("li").first().data("latitude"),o.closest("li").first().data("longitude"),o.closest("li").first().data("country_code"),o.closest("li").first().data("storefront_md"),o.closest("li").first().data("logo_md"),o.closest("li").first().data("slug")),o.closest("li").first().addClass("active")}).complete(function(){$(".location").on("click",function(){l.setMap(null),$(".list > li").removeClass("active"),$(this).toggleClass("active"),store.set("retailer_latitude",$(this).data("latitude")),store.set("retailer_longitude",$(this).data("longitude")),retailers.shop($(this).data("latitude"),$(this).data("longitude"),$(this).data("country_code"),$(this).data("storefront_md"),$(this).data("logo_md"),$(this).data("slug"))})})},$(".route").on("click",function(){function e(){var e=new google.maps.LatLng(store.get("latitude"),store.get("longitude")),o=new google.maps.LatLng(store.get("retailer_latitude"),store.get("retailer_longitude"));g.panTo(e),g.setCenter(e),g.setZoom(7),directionsDisplay.setMap(g),markerA=new google.maps.Marker({position:e,title:"Your Location",label:"A",map:g}),markerB=new google.maps.Marker({position:o,title:"Retailer",label:"B",map:g}),t(directionsService,directionsDisplay,e,o)}function t(e,t,o,s){e.route({origin:o,destination:s,avoidTolls:!0,avoidHighways:!1,travelMode:google.maps.TravelMode.DRIVING},function(e,o){o==google.maps.DirectionsStatus.OK?t.setDirections(e):window.alert("Directions request failed due to "+o)})}e()});var r,d,c=new Array,g=new google.maps.Map(document.getElementById(e),{styles:styles,zoom:7,mapTypeControl:!1,streetViewControl:!0,center:new google.maps.LatLng(t,o),mapTypeControl:!1,streetViewControl:!0,scrollwheel:!1,mapTypeControl:!0,scaleControl:!0,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_TOP}});for(store.get("latitude")?retailers.json("/app/"+store.get("latitude")+"/"+store.get("longitude")+"?shop="+s):navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){store.set("latitude",e.coords.latitude),store.set("longitude",e.coords.longitude),retailers.json("/app/"+e.coords.latitude+"/"+e.coords.longitude+"?shop="+s)},function(){retailers.json("/app/"+t+"/"+o+"?shop="+s)}):retailers.json("/app/"+t+"/"+o+"?shop="+s),d=0;d<a.length;d++)r=new google.maps.Marker({position:new google.maps.LatLng(a[d][0],a[d][1]),map:g,icon:a[d][5]}),c.push(r),google.maps.event.addListener(r,"click",function(e,t){return function(){retailers.shop(a[t][0],a[t][1],a[t][2],a[t][3],a[t][4])}}(r,d));var p=new List("retailers-list",{valueNames:["name","street_number","street_address","city","country","postcode","street_number","distance",{name:"location",data:["latitude","longitude"]},{name:"country_code",data:["country_code"]},{name:"logo_md",data:["logo_md"]},{name:"slug",data:["slug"]},{name:"storefront_md",data:["storefront_md"]}]})}console.log("Retailers Initialized")}}();